# 这是什么？
这是一个用 Python 实现的 vmt 原型机。

# 程序的工作流程
最终完成的程序大致为这样的工作流程。
1.  将文本整体读入为 Unicode 字符串。
2.  将字符串拆分为 Token。需要注意的是在部分命令后会直接读入一个浮点数或长度（暂未实现）。
3.  将 Token 逐个处理。一般的文本部分是线性结构，且大部分 Token 彼此独立，因此可以直接处理；对将来会加入的简谱、五线谱功能，则在读入 Token 的同时建立某种较复杂的多层结构，待读入环境结束符时再整体组版输出。
4.  字符分为3种不同的字体输出：
    1.  汉字字体。默认所有字符都是 1 em 的正方形，且不存在 kerning 或连字。
    2.  西文字体。字符的宽度依照 `hmtx` 表得出，且依照 `GPOS`、`GSUB` 两表做连字和 kerning。大致流程见下文说明。
    3.  专用符号字体。收录标点符号、数学符号、乐谱用符号等。前两者避免中文字体缺少符号。
5.  文本模式下，读取 Token 的大概流程：
    1.  读取的如果是文本 Token，则按 Unicode 算出字符分类值，同时用当前字体的 `cmap` 表出相应的 GID/CID。
    2.  如果字符属于西文，则暂时压着不输入，直到读取到第一个非西文 Token（即非字符 Token 或其他字符分类的 Token）为止。这时，按照字体的 `GPOS` 表处理所有的连字（`liga`）、组合（`ccmp`）。
    3.  然后，逐个输出字符到 hlist，同时用 `GSUB` 表读出对应的 kerning。
    4.  如果是其他类别的文本 Token，则直接输出。
    5.  其他类型的 Token 我暂时没有想好。
6.  读取字体尽量用 `fontconfig` 库（安装 `libfontconfig-dev`）。因为 `fontconfig` 没有读取 `GPOS`、`GSUB`、`hmtx` 等表的机能，因此需要自己写函数实现。
7.  简谱、五线谱部分不要急着做。

# 各文件说明
## `main.py`
主入口。

## `file_reader.py`
文件读取接口。

## `font_library.py`
用于读取字体。

## `global_var.py`
用于跨文件的变量（字体列表，字体编号等）。

## `tokenizer.py`
词法分析器（未写出分析数字的部分）。

## `token_process.py`
对读出的Token进行进一步的处理。